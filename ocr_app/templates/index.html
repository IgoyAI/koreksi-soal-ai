{% extends 'base.html' %}
{% block title %}OCR Checker{% endblock %}
{% block content %}
  <h1 class="mb-4">OCR Multiple Choice Checker</h1>
  {% if not project_name %}
    <div class="card">
      <div class="card-header"><h3 class="card-title">Create Project</h3></div>
      <div class="card-body">
        <form method="POST">
          <div class="form-group">
            <label for="project_name">Project Name</label>
            <input type="text" class="form-control" id="project_name" name="project_name" required>
          </div>
          <button type="submit" class="btn btn-primary">Create</button>
        </form>
      </div>
    </div>
  {% elif not exam_name %}
    <div class="card">
      <div class="card-header"><h3 class="card-title">Exam Details</h3></div>
      <div class="card-body">
        <form method="POST">
          <div class="form-group">
            <label for="exam_name">Exam Name</label>
            <input type="text" class="form-control" id="exam_name" name="exam_name" required>
          </div>
          <div class="form-group">
            <label for="num_questions">Number of Questions</label>
            <input type="number" class="form-control" id="num_questions" name="num_questions" min="1" max="100" value="{{ num_questions }}" required>
          </div>
          <button type="submit" class="btn btn-primary">Save Exam</button>
        </form>
      </div>
    </div>
  {% else %}
    <div class="mb-3">
      <h3>Project: {{ project_name }} - {{ exam_name }}</h3>
      <a class="btn btn-secondary" href="{{ url_for('download_sheet') }}">Download Answer Sheet</a>
    </div>
    <form method="POST">
      <ul class="list-group mb-3">
        {% for q in range(1, num_questions + 1) %}
        <li class="list-group-item">
          <div class="d-flex align-items-center">
            <strong class="mr-3">{{ q }}</strong>
            <div class="custom-control custom-radio mr-3" style="display:none"></div>
            {% for opt in ['A', 'B', 'C', 'D', 'E'] %}
              <div class="custom-control custom-radio mr-2">
                <input type="radio" id="q{{ q }}{{ opt }}" name="q{{ q }}" value="{{ opt }}" class="custom-control-input" {% if answer_key and answer_key[q-1]==opt %}checked{% endif %}>
                <label class="custom-control-label" for="q{{ q }}{{ opt }}">{{ opt }}</label>
              </div>
            {% endfor %}
          </div>
        </li>
        {% endfor %}
      </ul>
      <button type="submit" class="btn btn-primary">Save Answer Key</button>
    </form>
    <hr>
    <div class="card">
      <div class="card-header"><h3 class="card-title">Upload Answer Sheet</h3></div>
      <div class="card-body">
        <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
          <div class="form-group">
            <input type="file" class="form-control-file" name="files" accept="image/*" capture="environment" multiple required>
          </div>
          <button type="submit" class="btn btn-success">Upload and Check</button>
        </form>
      </div>
    </div>
  {% endif %}
{% endblock %}
